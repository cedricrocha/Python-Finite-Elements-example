# -*- coding: utf-8 -*-
"""fluxodecalor1D_Vilem.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1XaSvs1bwIukJkbtWq5McXDwEb02_yH7f

Código para resolver um problema simples de transmissão de calor, unidimensional, pelo método dos elementos fintos (problema do livro do Fish & Belytschko). Importamos as bibliotecas de algebra matricial e de gráficos


 ![image.png](data:image/png;base64,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)
"""

import numpy as np
import matplotlib.pyplot as plt

"""
Parâmetros do cálculo: comprimento total da barra,
área da seção transversal, constante elástica, comprimento dos elementos, módulo de Young. A dimensão do problema é igual ao número de nós. Exemplo 2 elementos lineares, 3 nós. 4 elementos lineares, 5 nós"""

#Quantidade de nós. deve ser modificado pelo usuário
nos = 3
#Vamos plotar dois cálculos para comparação
nos2 = 10
#Comprimento total da barra
comp = 4
#Seção transversal
A = 0.1
#Condutividade térmica
k = 2
#Temperatura fixa no primeiro nó (extremo esquerdo engastado)
T0 = 0
#Fluxo de calor no último nó (extremo direito)
q = 5
#Fonte interna de calor
s = 5


#A partir daqui, nada deve ser modidificado.Estrutura 1D - elementos = nos -1
elem = nos - 1
elem2 = nos2 - 1
#Tamanho dos elementos
l = comp / elem
l2 = comp / elem2
#Condutividade térmica dos elementos
k1 = A * k / l
k2 = A * k / l2
print(nos, elem, l, k1)
print(nos2, elem2, l2, k2)

"""Se quiséssemos escrever a matriz manualmente, no caso de dim=3, seria assim"""

#K=np.array([[0.1,-0.1,0], [-0.1,0.2,-0.1], [0.0,-0.1,0.1]])
#print(K)

"""Automatizando Matriz Rigidez. Método direto"""

#K1=np.identity(nos,float)
K1 = np.zeros((nos, nos))

for i in range(nos):
  for j in range (nos):
    if (i == j and (i == 0 or i == (nos - 1))):
      K1[i, j] = k1
    elif abs(i - j) == 1:
      K1[i, j] = -k1
    elif (i == j and (i != 0 or i != (nos - 1))):
      K1[i, j] = 2 * k1

print(K1)

"""Agora para a segunda análise com número maior de nós nos2

"""

#K2=np.identity(nos2,float)
K2 = np.zeros((nos2, nos2))

for i in range(nos2):
  for j in range (nos2):
    if (i == j and (i == 0 or i == (nos2 - 1))):
      K2[i, j] = k2
    elif abs(i - j) == 1:
      K2[i, j] = -k2
    elif (i == j and (i != 0 or i != (nos - 1))):
      K2[i, j] = 2 * k2

print(K2)

"""O determinante nulo indica que as condições de contorno do problema não foram definidas"""

#det=np.linalg.det(K1)
#print(det)
#u,v=np.linalg.eig(K1)
#print("Autovalores",u),
#print("Autovetores",v)

"""Se invertermmos a matriz singular, teremos uma mensagem de erro"""

#M=np.linalg.inv(K1)
#print(M)

"""Impondo BC. No caso, apenas o nó 1 está engastado.  Cortamos a linha 1 e a coluna 1 da matriz K1, pois o primeiro nó está fixo (engastado). Note que agora o determinante da submatriz livre não é mais nulo e ela é invesível



"""

S = K1[1:, 1:]
#S = np.identity(nos - 1, float)
#for i in range(nos - 1):
  #for j in range(nos - 1):
    #S[i, j] = K1[i + 1, j + 1]

print(S)
#det2=np.linalg.det(S)
#print(det2)

"""Para o segundo conjunto de nós"""

S2 = K2[1:, 1:]
#S2 = np.identity(nos2 - 1, float)
#for i in range(nos2 - 1):
  #for j in range(nos2 - 1):
    #S2[i, j] = K2[i + 1, j + 1]

print(S2)

INV = np.linalg.inv(S)
print(INV)
#print(np.linalg.det(INV))

INV2 = np.linalg.inv(S2)
print(INV2)

"""Apenas para verificação. O produto de uma matriz pela sua inversa deve dar a matriz identidade (números em potências 1o^(-16 são numericamente zero)"""

#I=INV@S
#print(I)

"""Source é a matriz coluna dos termos de fonte interna de calor, no exemplo s=5 W/m mas pode ser mudado acima. A matriz de força de corpo para cada elemento será dada pelo produto do interpolador de lagrange por esta matriz


"""

#Source=np.array([s,s])
#Fce=l/6*np.array([[2,1],[1,2]])@Source.T
#print(Fce)

"""Escrevemos as Matrizes de força de corpo, de superfície e total usando matrizes expandidas ao invés de matrizes de junção"""

Fc = np.zeros(nos)
for i in range(nos):
    if i == 0 or i == nos - 1 :
      Fc[i] = l * s / 2
      #print("Ciclo", i)
    else:
      Fc[i] = l * s

Fs = np.zeros(nos)
if  i == nos - 1:
  Fs[i] = -0.5
else:
  Fs[i] = 0

F = Fc + Fs
print(Fc, Fs, F)

"""Para o problema com nos2"""

Fc2 = np.zeros(nos2)
for i in range(nos2):
    if i == 0 or i == nos2 - 1:
      Fc2[i] = l2 * s / 2
      #print("Ciclo", i)
    else:
      Fc2[i] = l2 * s

Fs2 = np.zeros(nos2)
if  i == nos2 - 1 :
  Fs2[i] = -0.5
else:
  Fs2[i] = 0

F2 = Fc2 + Fs2
print(Fc2, Fs2, F2)

"""Cortamos os termos associados aos nós engastados (no caso, apenas o primeiro)"""

FL = F[1:]
#FL=np.ones(nos - 1)
#array1d=np.ones(3)
#print(array1d)

#for i in range(nos - 1) :
  #FL[i] = F[i + 1]

print(FL)

FL2 = F2[1:]
#FL2 = np.ones(nos2 - 1)
#for i in range(nos2 - 1):
  #FL2[i] = F2[i + 1]

print(FL2)

"""Multiplicando a inversa da submatriz de rigidez livre, com a matriz de força livre, obtemos os valores da temperatura nos 4 nós livres. A temperatura no nó engastado é dada: zero grau Celsius."""

T = INV @ FL
#print("Temperaturas com",nos,"nós:", T)

T2 = INV2 @ FL2
#print("Temperaturas com",nos2,"nós:", T2)

"""Para fazer o gráfico, determinamos os pontos das coordenadas dos nós. No caso de dim=5 são 0, 1, 2, 3, e 4  """

x1 = np.linspace(0, comp, nos)
print(x1)

x2 = np.linspace(0, comp, nos2)
print(x2)

"""Agora escrevemos a matriz de valores de temperatura, juntando os resultados calculados com o valor prescrito do nó engastado, x=0, T1=0"""

#Tc = np.ones(nos)
Tc = np.zeros(nos)

for i in range(nos):
  if i == 0:
     Tc[i] = 0.0
  else:
     Tc[i] = T[i - 1]

print("Temperaturas com", nos, "nós:", Tc)

#Tc2 = np.ones(nos2)
Tc2 = np.zeros(nos2)

for i in range(nos2):
  if i==0:
     Tc2[i] = 0.0
  else:
     Tc2[i] = T2[i - 1]

print("Temperaturas com", nos2, "nós:", Tc2)

"""Fazemos o gráfico, sobrepondo a solução exata do problema (quadrática) com os resultados que obtivemos"""

x = np.linspace(0, comp, 20)
Tex = -12.5 * x ** 2 + 97.5 * x
print("Nós 1 =", nos, "Nós 2 =", nos2)

# Criar uma figura e dois subplots lado a lado
fig, (ax1, ax2) = plt.subplots(1, 2)
# Aumenta o tamanho dos subplots proporcionalmente
#fig, (ax1, ax2) = plt.subplots(1, 2, gridspec_kw={'width_ratios': [3, 2]})

# Aumenta o tamanho dos subplots de forma idependente
fig.set_size_inches(9, 9)

ax1.plot(x, Tex, lw=4, label="exata"),
ax1.plot(x1, Tc, "o--", color="red", label='Elementos Finitos com nos={}' .format(nos))
ax1.set_xlabel("distância")
ax1.set_ylabel("Temperatura  C")
ax1.set_title("Temperatura barra 3 nós")
ax1.legend(loc='lower right', fontsize=10, ncol=1)

#Segundo gráfico do subplot
ax2.plot(x, Tex, lw=4, label="exata"),
ax2.plot(x2, Tc2, "*--", color="red", ms=10, label="Elementos Finitos com nos={}".format(nos2))
ax2.set_title("Temperatura barra 10 nós")
ax2.legend(loc='lower right', fontsize=10, ncol=1)

# Exibir os gráficos
plt.show()